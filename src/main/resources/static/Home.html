<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸ¤¿ ë‹¤ì´ë¹™ ì¥ë¹„ ê´€ë¦¬</title>

    <style>
        body { font-family: Arial; background:#f4f6f9; }
        h1 { text-align:center; }
        .container { width:80%; margin:auto; }
        .card {
            background:white;
            padding:20px;
            margin-top:20px;
            border-radius:10px;
            box-shadow:0 4px 10px rgba(0,0,0,0.1);
        }

        input { padding:6px; margin:5px; }

        button {
            padding:6px 12px;
            border:none;
            border-radius:6px;
            cursor:pointer;
            color:white;
        }

        .btn-primary { background:#3498db; }
        .btn-danger { background:#e74c3c; }
        .btn-warning { background:#f39c12; }
        .btn-success { background:#2ecc71; }

        table {
            width:100%;
            border-collapse:collapse;
            margin-top:15px;
        }

        th, td {
            padding:10px;
            text-align:center;
            border-bottom:1px solid #ddd;
        }

        th { background:#3498db; color:white; }

        .modal {
            display:none;
            position:fixed;
            top:0; left:0;
            width:100%; height:100%;
            background:rgba(0,0,0,0.5);
        }

        .modal-content {
            background:white;
            width:300px;
            margin:150px auto;
            padding:20px;
            border-radius:10px;
            text-align:center;
        }
    </style>
</head>

<body>

<h1>ğŸ¤¿ ë‹¤ì´ë¹™ ì¥ë¹„ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>

<div class="container">

    <!-- ğŸ” ì¡°íšŒ -->
    <div class="card">
        <h3>ğŸ” ì¡°íšŒ</h3>
        <input type="number" id="searchNum" placeholder="ë²ˆí˜¸ë¡œ ì¡°íšŒ">
        <button class="btn-primary" onclick="getByNum()">ë²ˆí˜¸ ì¡°íšŒ</button>

        <input type="text" id="searchName" placeholder="ì´ë¦„ìœ¼ë¡œ ì¡°íšŒ">
        <button class="btn-primary" onclick="getByName()">ì´ë¦„ ì¡°íšŒ</button>

        <button onclick="loadAll()">ì „ì²´ ë³´ê¸°</button>
    </div>

    <!-- â• ë“±ë¡ -->
    <div class="card">
        <h3>â• ì¥ë¹„ ë“±ë¡</h3>
        <input type="number" id="newNum" placeholder="ë²ˆí˜¸">
        <input type="text" id="newName" placeholder="ì´ë¦„">
        <input type="text" id="newStatus" placeholder="ìƒíƒœ">
        <button class="btn-success" onclick="createEquipment()">ë“±ë¡</button>
    </div>

    <!-- ğŸ“‹ ëª©ë¡ -->
    <div class="card">
        <h3>ğŸ“‹ ì¥ë¹„ ëª©ë¡</h3>
        <table>
            <thead>
            <tr>
                <th>ë²ˆí˜¸</th>
                <th>ì´ë¦„</th>
                <th>ìƒíƒœ</th>
                <th>ë°˜ë‚©ì¼</th>
                <th>ì˜ˆì•½ì¼</th>
                <th>ê´€ë¦¬</th>
            </tr>
            </thead>
            <tbody id="equipmentTable"></tbody>
        </table>
    </div>

</div>

<!-- âœ ìˆ˜ì • ëª¨ë‹¬ -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <h3>âœ ì¥ë¹„ ìˆ˜ì •</h3>
        <input type="hidden" id="editId">
        <input type="number" id="editNum"><br>
        <input type="text" id="editName"><br>
        <input type="text" id="editStatus"><br><br>
        <button class="btn-warning" onclick="updateEquipment()">ì €ì¥</button>
        <button onclick="closeModal()">ì·¨ì†Œ</button>
    </div>
</div>


<script>

    const API = "http://localhost:8080/api/equipments";

    /* ================= ì „ì²´ ì¡°íšŒ ================= */
    function loadAll(){
        fetch(API)
            .then(res => res.json())
            .then(data => renderTable(data))
            .catch(() => alert("ì „ì²´ ì¡°íšŒ ì‹¤íŒ¨"));
    }

    /* ================= ë²ˆí˜¸ ì¡°íšŒ ================= */
    function getByNum(){
        const num = document.getElementById("searchNum").value;
        if(!num){ alert("ë²ˆí˜¸ ì…ë ¥í•˜ì„¸ìš”"); return; }

        fetch(`${API}/num/${num}`)
            .then(res => {
                if(!res.ok) throw new Error();
                return res.json();
            })
            .then(data => renderTable([data]))
            .catch(() => alert("í•´ë‹¹ ë²ˆí˜¸ ì—†ìŒ"));
    }

    /* ================= ì´ë¦„ ì¡°íšŒ ================= */
    function getByName(){
        const name = document.getElementById("searchName").value;
        if(!name){ alert("ì´ë¦„ ì…ë ¥í•˜ì„¸ìš”"); return; }

        fetch(`${API}/name/${name}`)
            .then(res => {
                if(!res.ok) throw new Error();
                return res.json();
            })
            .then(data => renderTable([data]))
            .catch(() => alert("í•´ë‹¹ ì´ë¦„ ì—†ìŒ"));
    }

    /* ================= í…Œì´ë¸” ë Œë”ë§ (ì•ˆì „ ë²„ì „) ================= */
    function renderTable(data){
        const table = document.getElementById("equipmentTable");
        table.innerHTML = "";

        data.forEach(item => {

            const row = document.createElement("tr");

            row.innerHTML = `
            <td>${item.num ?? ""}</td>
            <td>${item.name ?? ""}</td>
            <td>${item.status ?? ""}</td>
            <td>${item.deadline ?? ""}</td>
            <td>${item.startdate ?? ""}</td>
            <td>
                <button class="btn-warning">ìˆ˜ì •</button>
                <button class="btn-danger">ì‚­ì œ</button>
            </td>
        `;

            const editBtn = row.querySelector(".btn-warning");
            const deleteBtn = row.querySelector(".btn-danger");

            // ğŸ”¥ UUID ì•ˆì „ ì „ë‹¬
            editBtn.onclick = () => openEdit(
                item.id,
                item.num,
                item.name,
                item.status
            );

            deleteBtn.onclick = () => deleteEquipment(item.id);

            table.appendChild(row);
        });
    }

    /* ================= ë“±ë¡ ================= */
    function createEquipment(){
        const num = Number(document.getElementById("newNum").value);
        const name = document.getElementById("newName").value;
        const status = document.getElementById("newStatus").value;

        fetch(API,{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({ num, name, status })
        })
            .then(res=>{
                if(!res.ok) throw new Error();
                alert("ë“±ë¡ ì™„ë£Œ");
                loadAll();
            })
            .catch(()=>alert("ë“±ë¡ ì‹¤íŒ¨"));
    }

    /* ================= ì‚­ì œ ================= */
    function deleteEquipment(id){
        if(!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        fetch(`${API}/${id}`,{ method:"DELETE" })
            .then(res=>{
                if(!res.ok) throw new Error();
                alert("ì‚­ì œ ì™„ë£Œ");
                loadAll();
            })
            .catch(()=>alert("ì‚­ì œ ì‹¤íŒ¨"));
    }

    /* ================= ìˆ˜ì • ëª¨ë‹¬ ================= */
    function openEdit(id,num,name,status){
        document.getElementById("editId").value = id;
        document.getElementById("editNum").value = num;
        document.getElementById("editName").value = name;
        document.getElementById("editStatus").value = status;
        document.getElementById("editModal").style.display="block";
    }

    function closeModal(){
        document.getElementById("editModal").style.display="none";
    }

    function updateEquipment(){
        const id = document.getElementById("editId").value;
        const num = document.getElementById("editNum").value;
        const name = document.getElementById("editName").value;
        const status = document.getElementById("editStatus").value;

        fetch(`${API}/${id}`,{
            method:"PUT",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({ num, name, status })
        })
            .then(res=>{
                if(!res.ok) throw new Error();
                alert("ìˆ˜ì • ì™„ë£Œ");
                closeModal();
                loadAll();
            })
            .catch(()=>alert("ìˆ˜ì • ì‹¤íŒ¨"));
    }

    /* ================= ì´ˆê¸° ì‹¤í–‰ ================= */
    loadAll();

</script>


</body>
</html>
