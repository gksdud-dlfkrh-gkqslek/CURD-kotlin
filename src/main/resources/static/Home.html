<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸ¤¿ ë‹¤ì´ë¹™ ì¥ë¹„ ê´€ë¦¬</title>

    <style>
        body { font-family: Arial; background:#f4f6f9; }
        h1 { text-align:center; }
        .container { width:80%; margin:auto; }
        .card {
            background:white;
            padding:20px;
            margin-top:20px;
            border-radius:10px;
            box-shadow:0 4px 10px rgba(0,0,0,0.1);
        }
        input { padding:6px; margin:5px; }
        button {
            padding:6px 12px;
            border:none;
            border-radius:6px;
            cursor:pointer;
        }
        .btn-primary { background:#3498db; color:white; }
        .btn-danger { background:#e74c3c; color:white; }
        .btn-warning { background:#f39c12; color:white; }
        .btn-success { background:#2ecc71; color:white; }

        table { width:100%; border-collapse:collapse; margin-top:15px; }
        th, td {
            padding:10px;
            text-align:center;
            border-bottom:1px solid #ddd;
        }
        th { background:#3498db; color:white; }

        .modal {
            display:none;
            position:fixed;
            top:0; left:0;
            width:100%; height:100%;
            background:rgba(0,0,0,0.5);
        }
        .modal-content {
            background:white;
            width:300px;
            margin:150px auto;
            padding:20px;
            border-radius:10px;
            text-align:center;
        }
    </style>
</head>

<body>

<h1>ğŸ¤¿ ë‹¤ì´ë¹™ ì¥ë¹„ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>

<div class="container">

    <!-- ğŸ” ë‹¨ê±´ ì¡°íšŒ -->
    <div class="card">
        <h3>ğŸ” ë‹¨ê±´ ì¡°íšŒ</h3>
        <input type="number" id="searchNum" placeholder="ì¥ë¹„ ë²ˆí˜¸">
        <button class="btn-primary" onclick="getOne()">ì¡°íšŒ</button>
        <button onclick="loadAll()">ì „ì²´ ë³´ê¸°</button>
    </div>

    <!-- â• ë“±ë¡ -->
    <div class="card">
        <h3>â• ì¥ë¹„ ë“±ë¡</h3>
        <input type="number" id="newNum" placeholder="ë²ˆí˜¸">
        <input type="text" id="newName" placeholder="ì´ë¦„">
        <input type="text" id="newStatus" placeholder="ìƒíƒœ">
        <input type="date" id="newDeadline">
        <button class="btn-success" onclick="createEquipment()">ë“±ë¡</button>
    </div>

    <!-- ğŸ“‹ ì „ì²´ ì¡°íšŒ -->
    <div class="card">
        <h3>ğŸ“‹ ì¥ë¹„ ëª©ë¡</h3>
        <table>
            <thead>
            <tr>
                <th>ë²ˆí˜¸</th>
                <th>ì´ë¦„</th>
                <th>ìƒíƒœ</th>
                <th>ë§ˆê°ì¼</th>
                <th>ê´€ë¦¬</th>
            </tr>
            </thead>
            <tbody id="equipmentTable"></tbody>
        </table>
    </div>

</div>

<!-- âœ ìˆ˜ì • ëª¨ë‹¬ -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <h3>âœ ì¥ë¹„ ìˆ˜ì •</h3>
        <input type="hidden" id="editNum">
        <input type="text" id="editName"><br>
        <input type="text" id="editStatus"><br>
        <input type="date" id="editDeadline"><br><br>
        <button class="btn-warning" onclick="updateEquipment()">ì €ì¥</button>
        <button onclick="closeModal()">ì·¨ì†Œ</button>
    </div>
</div>

<script>

    const API = "http://localhost:8080/api/equipment";

    /* ================= ì „ì²´ ì¡°íšŒ ================= */
    function loadAll(){
        fetch(`${API}/get`)
            .then(res => res.json())
            .then(renderTable)
            .catch(()=>alert("ì„œë²„ ì˜¤ë¥˜"));
    }

    /* ================= ë‹¨ê±´ ì¡°íšŒ ================= */
    function getOne(){
        const num = document.getElementById("searchNum").value;

        fetch(`${API}/get/${num}`)
            .then(res=>{
                if(!res.ok) throw new Error();
                return res.json();
            })
            .then(data=>{
                renderTable([data]); // ë°°ì—´ë¡œ ê°ì‹¸ì„œ ì¬ì‚¬ìš©
            })
            .catch(()=>alert("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¥ë¹„ ë²ˆí˜¸ì…ë‹ˆë‹¤."));
    }

    /* ================= í…Œì´ë¸” ë Œë”ë§ ================= */
    function renderTable(data){
        const table = document.getElementById("equipmentTable");
        table.innerHTML="";

        data.forEach(item=>{
            table.innerHTML += `
        <tr>
            <td>${item.num}</td>
            <td>${item.name}</td>
            <td>${item.status}</td>
            <td>${item.deadline ?? ""}</td>
            <td>
                <button class="btn-warning" onclick="openEditFromRow(this)">ìˆ˜ì •</button>
                <button class="btn-danger" onclick="deleteEquipment(${item.num})">ì‚­ì œ</button>
            </td>
        </tr>`;
        });
    }

    /* ================= ë“±ë¡ ================= */
    function createEquipment(){
        fetch(`${API}/post`,{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({
                num:document.getElementById("newNum").value,
                name:document.getElementById("newName").value,
                status:document.getElementById("newStatus").value,
                deadline:document.getElementById("newDeadline").value
            })
        })
            .then(res=>{
                if(res.ok){
                    alert("ë“±ë¡ ì™„ë£Œ");
                    document.getElementById("newNum").value="";
                    document.getElementById("newName").value="";
                    document.getElementById("newStatus").value="";
                    document.getElementById("newDeadline").value="";
                    loadAll();
                } else {
                    alert("ë“±ë¡ ì‹¤íŒ¨");
                }
            })
            .catch(()=>alert("ì„œë²„ ì˜¤ë¥˜"));
    }

    /* ================= ì‚­ì œ ================= */
    function deleteEquipment(num){
        if(!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        fetch(`${API}/delete/${num}`,{method:"DELETE"})
            .then(res=>{
                if(res.ok){
                    alert("ì‚­ì œ ì™„ë£Œ");
                    loadAll();
                } else {
                    alert("ì‚­ì œ ì‹¤íŒ¨");
                }
            })
            .catch(()=>alert("ì„œë²„ ì˜¤ë¥˜"));
    }

    /* ================= ìˆ˜ì • ================= */
    function openEditFromRow(btn){
        const row = btn.closest("tr");
        const cells = row.querySelectorAll("td");

        document.getElementById("editNum").value = cells[0].innerText;
        document.getElementById("editName").value = cells[1].innerText;
        document.getElementById("editStatus").value = cells[2].innerText;
        document.getElementById("editDeadline").value = cells[3].innerText;

        document.getElementById("editModal").style.display="block";
    }

    function closeModal(){
        document.getElementById("editModal").style.display="none";
    }

    function updateEquipment(){
        const num = document.getElementById("editNum").value;

        fetch(`${API}/put/${num}`,{
            method:"PUT",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({
                name:document.getElementById("editName").value,
                status:document.getElementById("editStatus").value,
                deadline:document.getElementById("editDeadline").value
            })
        })
            .then(res=>{
                if(res.ok){
                    alert("ìˆ˜ì • ì™„ë£Œ");
                    closeModal();
                    loadAll();
                } else {
                    alert("ìˆ˜ì • ì‹¤íŒ¨");
                }
            })
            .catch(()=>alert("ì„œë²„ ì˜¤ë¥˜"));
    }

    /* ================= ì´ˆê¸° ë¡œë”© ================= */
    loadAll();

</script>

</body>
</html>
