<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ê´€ë¦¬ì í˜ì´ì§€ â€” ì¥ë¹„ ì˜ˆì•½ ì‹œìŠ¤í…œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet"/>
    <style>
        :root {
          --bg:        #0d0f14;
          --surface:   #13161f;
          --card:      #191c28;
          --border:    #252838;
          --border2:   #2e3348;
          --accent:    #4f8ef7;
          --accent2:   #7c5cfc;
          --accent-lt: rgba(79,142,247,.1);
          --green:     #2ecc8a;
          --green-bg:  rgba(46,204,138,.1);
          --red:       #ff4f6a;
          --red-bg:    rgba(255,79,106,.1);
          --yellow:    #f7b731;
          --yellow-bg: rgba(247,183,49,.1);
          --text:      #e8eaf2;
          --text-sub:  #b0b7d4;
          --text-muted:#6b7294;
          --text-dim:  #3e4260;
          --shadow:    0 2px 8px rgba(0,0,0,.3);
          --shadow-md: 0 8px 32px rgba(0,0,0,.4);
          --shadow-lg: 0 20px 60px rgba(0,0,0,.6);
        }
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:'Noto Sans KR',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column;}

        /* â”€â”€ HEADER â”€â”€ */
        header{background:var(--surface);border-bottom:1px solid var(--border);height:54px;display:flex;align-items:center;justify-content:space-between;padding:0 1.5rem;position:sticky;top:0;z-index:100;}
        .logo{display:flex;align-items:center;gap:.6rem;font-family:'JetBrains Mono',monospace;font-size:.88rem;font-weight:700;color:var(--accent);}
        .logo-box{width:28px;height:28px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:.8rem;}
        .admin-chip{background:rgba(255,79,106,.12);border:1px solid rgba(255,79,106,.25);color:var(--red);border-radius:999px;padding:.15rem .6rem;font-size:.68rem;font-weight:700;letter-spacing:.05em;}
        .header-right{display:flex;align-items:center;gap:.8rem;}
        .btn-logout{height:30px;padding:0 .8rem;border:1px solid var(--border2);background:transparent;color:var(--text-muted);border-radius:7px;cursor:pointer;font-size:.75rem;font-family:'Noto Sans KR',sans-serif;transition:all .15s;}
        .btn-logout:hover{border-color:var(--red);color:var(--red);}

        /* â”€â”€ LAYOUT â”€â”€ */
        .layout{display:grid;grid-template-columns:200px 1fr;flex:1;}

        /* â”€â”€ SIDEBAR â”€â”€ */
        aside{background:var(--surface);border-right:1px solid var(--border);padding:1rem .6rem;display:flex;flex-direction:column;gap:.15rem;position:sticky;top:54px;height:calc(100vh - 54px);overflow-y:auto;}
        .side-section-label{font-size:.6rem;font-weight:700;color:var(--text-dim);letter-spacing:.12em;text-transform:uppercase;padding:.6rem .6rem .3rem;}
        .nav-item{display:flex;align-items:center;gap:.55rem;padding:.5rem .7rem;border-radius:7px;cursor:pointer;font-size:.8rem;color:var(--text-muted);transition:all .15s;border:none;background:none;width:100%;text-align:left;font-family:'Noto Sans KR',sans-serif;}
        .nav-item:hover{background:var(--card);color:var(--text-sub);}
        .nav-item.active{background:var(--accent-lt);color:var(--accent);font-weight:600;}
        .nav-icon{font-size:.85rem;width:18px;text-align:center;}

        /* â”€â”€ MAIN â”€â”€ */
        main{padding:1.5rem;overflow-y:auto;}
        .section{display:none;}
        .section.active{display:block;animation:fadeIn .2s ease;}
        @keyframes fadeIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}

        .page-title{font-size:1.1rem;font-weight:800;margin-bottom:.25rem;}
        .page-sub{font-size:.75rem;color:var(--text-muted);margin-bottom:1.2rem;}

        /* â”€â”€ STATS â”€â”€ */
        .stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:.75rem;margin-bottom:1.5rem;}
        .stat-card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:.9rem 1rem;display:flex;align-items:center;gap:.75rem;}
        .stat-icon{width:36px;height:36px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0;}
        .si-blue{background:rgba(79,142,247,.12);}
        .si-green{background:rgba(46,204,138,.12);}
        .si-yellow{background:rgba(247,183,49,.12);}
        .si-red{background:rgba(255,79,106,.12);}
        .stat-label{font-size:.65rem;color:var(--text-muted);margin-bottom:.15rem;}
        .stat-val{font-size:1.35rem;font-weight:800;font-family:'JetBrains Mono',monospace;}
        .sv-blue{color:var(--accent);}
        .sv-green{color:var(--green);}
        .sv-yellow{color:var(--yellow);}
        .sv-red{color:var(--red);}

        /* â”€â”€ TOOLBAR â”€â”€ */
        .toolbar{display:flex;align-items:center;gap:.6rem;margin-bottom:.9rem;flex-wrap:wrap;}
        .search-wrap{position:relative;}
        .search-wrap input{height:34px;background:var(--card);border:1px solid var(--border);border-radius:8px;padding:0 .8rem 0 2rem;font-size:.78rem;font-family:'Noto Sans KR',sans-serif;color:var(--text);outline:none;transition:border-color .15s;width:180px;}
        .search-wrap input:focus{border-color:var(--accent);}
        .search-wrap input::placeholder{color:var(--text-dim);}
        .search-icon{position:absolute;left:.6rem;top:50%;transform:translateY(-50%);color:var(--text-dim);font-size:.75rem;}
        .btn-sm{height:34px;padding:0 .85rem;border-radius:8px;font-size:.75rem;font-weight:600;cursor:pointer;font-family:'Noto Sans KR',sans-serif;transition:all .15s;display:flex;align-items:center;gap:.35rem;white-space:nowrap;}
        .btn-primary{background:var(--accent);color:#fff;border:none;}
        .btn-primary:hover{background:#3d7ef5;transform:translateY(-1px);}
        .btn-outline{background:transparent;border:1px solid var(--border2);color:var(--text-muted);}
        .btn-outline:hover{border-color:var(--accent);color:var(--accent);}
        .btn-danger{background:transparent;border:1px solid rgba(255,79,106,.3);color:var(--red);}
        .btn-danger:hover{background:var(--red-bg);}

        /* â”€â”€ TABLE â”€â”€ */
        .table-wrap{background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden;}
        table{width:100%;border-collapse:collapse;}
        thead tr{background:rgba(255,255,255,.02);}
        th{padding:.65rem 1rem;text-align:left;font-size:.65rem;font-weight:700;color:var(--text-muted);text-transform:uppercase;letter-spacing:.07em;border-bottom:1px solid var(--border);white-space:nowrap;}
        td{padding:.75rem 1rem;font-size:.8rem;border-bottom:1px solid rgba(255,255,255,.03);vertical-align:middle;}
        tr:last-child td{border-bottom:none;}
        tbody tr{transition:background .1s;}
        tbody tr:hover td{background:rgba(255,255,255,.02);}
        .mono{font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--text-muted);}

        .badge{display:inline-flex;align-items:center;gap:.25rem;padding:.15rem .55rem;border-radius:999px;font-size:.68rem;font-weight:600;white-space:nowrap;}
        .badge::before{content:'â—';font-size:.45rem;}
        .badge.normal{background:var(--green-bg);color:var(--green);}
        .badge.repair{background:var(--yellow-bg);color:var(--yellow);}
        .badge.broken{background:var(--red-bg);color:var(--red);}
        .badge.rsv-yes{background:var(--red-bg);color:var(--red);}
        .badge.rsv-no{background:var(--green-bg);color:var(--green);}
        .badge.admin{background:rgba(79,142,247,.12);color:var(--accent);}
        .badge.user{background:rgba(46,204,138,.12);color:var(--green);}

        .td-actions{display:flex;gap:.4rem;align-items:center;}
        .btn-icon{width:28px;height:28px;border-radius:6px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.8rem;transition:all .15s;}
        .btn-icon.edit{background:rgba(79,142,247,.1);color:var(--accent);}
        .btn-icon.edit:hover{background:rgba(79,142,247,.2);}
        .btn-icon.del{background:rgba(255,79,106,.1);color:var(--red);}
        .btn-icon.del:hover{background:rgba(255,79,106,.2);}

        /* â”€â”€ FORM CARD â”€â”€ */
        .form-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:1.25rem;}
        .form-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:.9rem;margin-bottom:1rem;}
        .form-group{display:flex;flex-direction:column;gap:.35rem;}
        .form-label{font-size:.72rem;font-weight:600;color:var(--text-muted);}
        .form-input,.form-select{height:38px;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:0 .85rem;font-size:.8rem;font-family:'Noto Sans KR',sans-serif;color:var(--text);outline:none;transition:border-color .15s;width:100%;}
        .form-input:focus,.form-select:focus{border-color:var(--accent);}
        .form-input::placeholder{color:var(--text-dim);}
        .form-select option{background:var(--card);}
        .form-footer{display:flex;justify-content:flex-end;gap:.6rem;}

        /* â”€â”€ SEARCH RESULT â”€â”€ */
        .search-result-wrap{margin-bottom:1rem;}
        .search-bar{display:flex;gap:.6rem;margin-bottom:.8rem;flex-wrap:wrap;}
        .search-input-group{display:flex;gap:.4rem;align-items:center;}
        .search-label{font-size:.75rem;color:var(--text-muted);white-space:nowrap;}

        /* â”€â”€ LOADING / EMPTY â”€â”€ */
        .loading-box{display:flex;align-items:center;justify-content:center;padding:3rem;color:var(--text-muted);font-size:.8rem;gap:.5rem;}
        .spinner{width:15px;height:15px;border:2px solid var(--border2);border-top-color:var(--accent);border-radius:50%;animation:spin .7s linear infinite;}
        @keyframes spin{to{transform:rotate(360deg)}}
        .empty-box{text-align:center;padding:3rem;color:var(--text-muted);}
        .empty-box .ei{font-size:2rem;margin-bottom:.5rem;}
        .empty-box p{font-size:.78rem;}

        /* â”€â”€ MODAL â”€â”€ */
        .modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);z-index:300;align-items:center;justify-content:center;}
        .modal-overlay.show{display:flex;}
        .modal{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:1.75rem;width:100%;max-width:420px;box-shadow:var(--shadow-lg);animation:modalIn .25s cubic-bezier(.34,1.56,.64,1);}
        @keyframes modalIn{from{opacity:0;transform:scale(.93)}to{opacity:1;transform:scale(1)}}
        .modal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.25rem;}
        .modal-title{font-size:.95rem;font-weight:800;}
        .modal-close{width:26px;height:26px;border:none;background:var(--border);border-radius:6px;cursor:pointer;color:var(--text-muted);font-size:.9rem;display:flex;align-items:center;justify-content:center;transition:all .15s;}
        .modal-close:hover{background:var(--border2);color:var(--text);}
        .modal-form{display:flex;flex-direction:column;gap:.85rem;}
        .modal-footer{display:flex;gap:.6rem;margin-top:1.25rem;}
        .btn-modal-cancel{flex:1;height:38px;border:1px solid var(--border2);background:transparent;color:var(--text-muted);border-radius:8px;cursor:pointer;font-size:.82rem;font-family:'Noto Sans KR',sans-serif;}
        .btn-modal-confirm{flex:2;height:38px;background:var(--accent);color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:.82rem;font-weight:700;font-family:'Noto Sans KR',sans-serif;}
        .btn-modal-confirm:hover{background:#3d7ef5;}
        .btn-modal-danger{flex:2;height:38px;background:var(--red);color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:.82rem;font-weight:700;font-family:'Noto Sans KR',sans-serif;}

        /* confirm modal */
        .confirm-modal{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:1.75rem;width:100%;max-width:320px;text-align:center;box-shadow:var(--shadow-lg);animation:modalIn .25s cubic-bezier(.34,1.56,.64,1);}
        .confirm-icon{font-size:2rem;margin-bottom:.7rem;}
        .confirm-title{font-size:.95rem;font-weight:800;margin-bottom:.3rem;}
        .confirm-desc{font-size:.78rem;color:var(--text-muted);margin-bottom:1.2rem;line-height:1.6;}
        .confirm-btns{display:flex;gap:.6rem;}
        .btn-no{flex:1;height:36px;border:1px solid var(--border2);background:transparent;color:var(--text-muted);border-radius:8px;cursor:pointer;font-size:.8rem;font-family:'Noto Sans KR',sans-serif;}
        .btn-yes{flex:1;height:36px;background:var(--red);color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:.8rem;font-weight:700;font-family:'Noto Sans KR',sans-serif;}

        /* â”€â”€ TOAST â”€â”€ */
        .toast{position:fixed;bottom:1.5rem;right:1.5rem;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:.65rem 1rem;font-size:.78rem;box-shadow:var(--shadow-md);display:flex;align-items:center;gap:.45rem;transform:translateY(12px);opacity:0;transition:all .25s cubic-bezier(.34,1.56,.64,1);z-index:999;pointer-events:none;}
        .toast.show{opacity:1;transform:translateY(0);}
        .toast.success{border-color:rgba(46,204,138,.3);color:var(--green);}
        .toast.error{border-color:rgba(255,79,106,.3);color:var(--red);}
        .toast.info{border-color:rgba(79,142,247,.3);color:var(--accent);}

        /* section divider */
        .section-divider{height:1px;background:var(--border);margin:1.25rem 0;}
        .section-subtitle{font-size:.8rem;font-weight:700;color:var(--text-sub);margin-bottom:.75rem;display:flex;align-items:center;gap:.4rem;}
    </style>
</head>
<body>

<!-- ìˆ˜ì • ëª¨ë‹¬ -->
<div class="modal-overlay" id="editModal">
    <div class="modal">
        <div class="modal-header">
            <div class="modal-title">âœï¸ ì¥ë¹„ ì •ë³´ ìˆ˜ì •</div>
            <button class="modal-close" onclick="closeModal('editModal')">âœ•</button>
        </div>
        <div class="modal-form">
            <input type="hidden" id="editId"/>
            <div class="form-group">
                <label class="form-label">ë²ˆí˜¸ (num)</label>
                <input type="number" class="form-input" id="editNum" placeholder="ì¥ë¹„ ë²ˆí˜¸"/>
            </div>
            <div class="form-group">
                <label class="form-label">ì¥ë¹„ëª… (name)</label>
                <input type="text" class="form-input" id="editName" placeholder="ì¥ë¹„ëª…"/>
            </div>
            <div class="form-group">
                <label class="form-label">ìƒíƒœ (status)</label>
                <select class="form-select" id="editStatus">
                    <option value="ì •ìƒ">ì •ìƒ</option>
                    <option value="ìˆ˜ë¦¬">ìˆ˜ë¦¬</option>
                    <option value="ê³ ì¥">ê³ ì¥</option>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-modal-cancel" onclick="closeModal('editModal')">ì·¨ì†Œ</button>
            <button class="btn-modal-confirm" onclick="submitEdit()">ìˆ˜ì • ì™„ë£Œ</button>
        </div>
    </div>
</div>

<!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
<div class="modal-overlay" id="confirmModal">
    <div class="confirm-modal">
        <div class="confirm-icon" id="confirmIcon">âš ï¸</div>
        <div class="confirm-title" id="confirmTitle">ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
        <div class="confirm-desc"  id="confirmDesc">ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
        <div class="confirm-btns">
            <button class="btn-no"  onclick="closeModal('confirmModal')">ì·¨ì†Œ</button>
            <button class="btn-yes" id="confirmYesBtn">ì‚­ì œ</button>
        </div>
    </div>
</div>

<!-- Header -->
<header>
    <div class="logo">
        <div class="logo-box">âš™</div>
        EQUIPÂ·ADMIN
        <span class="admin-chip">ADMIN</span>
    </div>
    <div class="header-right">
        <button class="btn-logout" onclick="doLogout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
</header>

<div class="layout">
    <!-- Sidebar -->
    <aside>
        <div class="side-section-label">ì¥ë¹„ ê´€ë¦¬</div>
        <button class="nav-item active" id="nav-equipment-list"   onclick="switchTab('equipment-list')"><span class="nav-icon">ğŸ–¥</span>ì „ì²´ ì¥ë¹„ ì¡°íšŒ</button>
        <button class="nav-item"        id="nav-equipment-search" onclick="switchTab('equipment-search')"><span class="nav-icon">ğŸ”</span>ì¥ë¹„ ë‹¨ê±´ ì¡°íšŒ</button>
        <button class="nav-item"        id="nav-equipment-add"    onclick="switchTab('equipment-add')"><span class="nav-icon">â•</span>ì¥ë¹„ ë“±ë¡</button>
        <div class="side-section-label">ì˜ˆì•½ ê´€ë¦¬</div>
        <button class="nav-item"        id="nav-reservations"     onclick="switchTab('reservations')"><span class="nav-icon">ğŸ“Œ</span>ì˜ˆì•½ í˜„í™©</button>
        <div class="side-section-label">ì‚¬ìš©ì ê´€ë¦¬</div>
        <button class="nav-item"        id="nav-users"            onclick="switchTab('users')"><span class="nav-icon">ğŸ‘¥</span>ìœ ì € ì¡°íšŒ</button>
        <button class="nav-item" id="nav-approvals" onclick="switchTab('approvals')">
            <span class="nav-icon">âœ…</span> ìŠ¹ì¸ ìš”ì²­
            <span class="nav-count" id="approvalCount" style="display:none">0</span>
        </button>
    </aside>

    <!-- Main -->
    <main>

        <!-- â‘  ì „ì²´ ì¥ë¹„ ì¡°íšŒ -->
        <div class="section active" id="section-equipment-list">
            <div class="page-title">ì „ì²´ ì¥ë¹„ ëª©ë¡</div>
            <div class="page-sub">ë“±ë¡ëœ ëª¨ë“  ì¥ë¹„ë¥¼ ì¡°íšŒí•˜ê³  ìˆ˜ì •Â·ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>

            <div class="stats-grid">
                <div class="stat-card"><div class="stat-icon si-blue">ğŸ–¥</div><div><div class="stat-label">ì „ì²´</div><div class="stat-val sv-blue" id="sTotal">-</div></div></div>
                <div class="stat-card"><div class="stat-icon si-green">âœ…</div><div><div class="stat-label">ì˜ˆì•½ê°€ëŠ¥</div><div class="stat-val sv-green" id="sAvail">-</div></div></div>
                <div class="stat-card"><div class="stat-icon si-yellow">ğŸ“Œ</div><div><div class="stat-label">ì˜ˆì•½ë¨</div><div class="stat-val sv-yellow" id="sReserved">-</div></div></div>
                <div class="stat-card"><div class="stat-icon si-red">ğŸ”§</div><div><div class="stat-label">ìˆ˜ë¦¬/ê³ ì¥</div><div class="stat-val sv-red" id="sBroken">-</div></div></div>
            </div>

            <div class="toolbar">
                <div class="search-wrap">
                    <span class="search-icon">ğŸ”</span>
                    <input type="text" id="listSearch" placeholder="ì¥ë¹„ëª… ê²€ìƒ‰..." oninput="filterEquipList()"/>
                </div>
                <button class="btn-sm btn-outline" onclick="loadEquipments()">â†º ìƒˆë¡œê³ ì¹¨</button>
            </div>

            <div class="table-wrap" id="equipListWrap">
                <div class="loading-box"><div class="spinner"></div> ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>

        <!-- â‘¡ ë‹¨ê±´ ì¡°íšŒ -->
        <div class="section" id="section-equipment-search">
            <div class="page-title">ì¥ë¹„ ë‹¨ê±´ ì¡°íšŒ</div>
            <div class="page-sub">ë²ˆí˜¸(num) ë˜ëŠ” ì´ë¦„(name)ìœ¼ë¡œ ì¥ë¹„ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤</div>

            <div class="form-card" style="margin-bottom:1rem;">
                <div class="search-bar">
                    <div class="search-input-group">
                        <span class="search-label">ë²ˆí˜¸</span>
                        <input type="number" class="form-input" id="searchByNum" placeholder="ì˜ˆ: 1" style="width:120px;"/>
                        <button class="btn-sm btn-primary" onclick="searchByNum()">ê²€ìƒ‰</button>
                    </div>
                    <div style="color:var(--text-dim);font-size:.8rem;display:flex;align-items:center;">ë˜ëŠ”</div>
                    <div class="search-input-group">
                        <span class="search-label">ì´ë¦„</span>
                        <input type="text" class="form-input" id="searchByName" placeholder="ì˜ˆ: ë…¸íŠ¸ë¶" style="width:140px;"/>
                        <button class="btn-sm btn-primary" onclick="searchByName()">ê²€ìƒ‰</button>
                    </div>
                    <button class="btn-sm btn-outline" onclick="clearSearchResult()">ì´ˆê¸°í™”</button>
                </div>
            </div>

            <div class="table-wrap" id="searchResultWrap">
                <div class="empty-box"><div class="ei">ğŸ”</div><p>ë²ˆí˜¸ ë˜ëŠ” ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰í•˜ì„¸ìš”</p></div>
            </div>
        </div>

        <!-- â‘¢ ì¥ë¹„ ë“±ë¡ -->
        <div class="section" id="section-equipment-add">
            <div class="page-title">ì¥ë¹„ ë“±ë¡</div>
            <div class="page-sub">ìƒˆ ì¥ë¹„ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤</div>

            <div class="form-card">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">ë²ˆí˜¸ (num) *</label>
                        <input type="number" class="form-input" id="addNum" placeholder="ì¥ë¹„ ë²ˆí˜¸"/>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì¥ë¹„ëª… (name) *</label>
                        <input type="text" class="form-input" id="addName" placeholder="ì¥ë¹„ëª… ì…ë ¥"/>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ìƒíƒœ (status) *</label>
                        <select class="form-select" id="addStatus">
                            <option value="ì •ìƒ">ì •ìƒ</option>
                            <option value="ìˆ˜ë¦¬">ìˆ˜ë¦¬</option>
                            <option value="ê³ ì¥">ê³ ì¥</option>
                        </select>
                    </div>
                </div>
                <div class="form-footer">
                    <button class="btn-sm btn-outline" onclick="clearAddForm()">ì´ˆê¸°í™”</button>
                    <button class="btn-sm btn-primary" onclick="addEquipment()">â• ì¥ë¹„ ë“±ë¡</button>
                </div>
            </div>
        </div>

        <!-- â‘£ ì˜ˆì•½ í˜„í™© -->
        <div class="section" id="section-reservations">
            <div class="page-title">ì˜ˆì•½ í˜„í™©</div>
            <div class="page-sub">í˜„ì¬ ì˜ˆì•½ëœ ì¥ë¹„ ëª©ë¡ì…ë‹ˆë‹¤ (ì˜ˆì•½ì¼ Â· ë°˜ë‚©ê¸°í•œ í¬í•¨)</div>

            <div class="toolbar">
                <button class="btn-sm btn-outline" onclick="loadReservations()">â†º ìƒˆë¡œê³ ì¹¨</button>
            </div>

            <div class="table-wrap" id="reservationWrap">
                <div class="loading-box"><div class="spinner"></div> ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>

        <!-- â‘¤ ìœ ì € ì¡°íšŒ -->
        <div class="section" id="section-users">
            <div class="page-title">ìœ ì € ê´€ë¦¬</div>
            <div class="page-sub">ê°€ì…ëœ ì‚¬ìš©ì ëª©ë¡ì„ ì¡°íšŒí•˜ê³  ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>

            <div class="toolbar">
                <div class="search-wrap">
                    <span class="search-icon">ğŸ”</span>
                    <input type="text" id="userSearch" placeholder="ì´ë¦„ ê²€ìƒ‰..." oninput="filterUserList()"/>
                </div>
                <button class="btn-sm btn-outline" onclick="loadUsers()">â†º ìƒˆë¡œê³ ì¹¨</button>
            </div>

            <div class="table-wrap" id="userListWrap">
                <div class="loading-box"><div class="spinner"></div> ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>


        <!-- ìŠ¹ì¸ ìš”ì²­ ëª©ë¡ -->
        <div class="section" id="section-approvals">
            <div class="page-title">ìŠ¹ì¸ ìš”ì²­ ëª©ë¡</div>
            <div class="page-sub">ê°€ì… ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ì‚¬ìš©ì ëª©ë¡ì…ë‹ˆë‹¤</div>
            <div class="toolbar">
                <button class="btn-sm btn-outline" onclick="loadApprovals()">â†º ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <div class="table-wrap" id="approvalWrap">
                <div class="loading-box"><div class="spinner"></div> ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>

    </main>
</div>

<div class="toast" id="toast"></div>

<script>
    const API = '/api';
    let allEquipments = [];
    let allUsers      = [];
    let pendingAction = null; // í™•ì¸ ëª¨ë‹¬ ì½œë°±

    // â”€â”€ íƒ­ ì „í™˜
    function switchTab(tab) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      document.getElementById('section-' + tab).classList.add('active');
      document.getElementById('nav-' + tab).classList.add('active');

      if (tab === 'equipment-list') loadEquipments();
      if (tab === 'reservations')   loadReservations();
      if (tab === 'users')          loadUsers();
    }

    // â”€â”€ ì´ˆê¸° ë¡œë“œ
    window.onload = () => {
      loadEquipments();
      loadUsers();
    };

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„¸ì…˜ ì²´í¬
    (async () => {
        try {
            const res = await fetch('/api/auth/me', { credentials: 'include' });
            if (!res.ok) {
                location.href = '/login.html';
                return;
            }
            const user = await res.json();
            // ê´€ë¦¬ìê°€ ì•„ë‹ˆë©´ ì ‘ê·¼ ì°¨ë‹¨
            if (user.role !== 'ADMIN') {
                location.href = '/login.html';
            }
        } catch (e) {
            location.href = '/login.html';
        }
    })();

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â‘  ì „ì²´ ì¥ë¹„ ì¡°íšŒ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function loadEquipments() {
      document.getElementById('equipListWrap').innerHTML =
        `<div class="loading-box"><div class="spinner"></div> ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>`;
      try {
        const res = await fetch(`${API}/equipments`, { credentials: 'include' });
        allEquipments = await res.json();
        updateStats();
        renderEquipTable(allEquipments, 'equipListWrap', true);
      } catch (e) {
        document.getElementById('equipListWrap').innerHTML =
          `<div class="empty-box"><div class="ei">âš ï¸</div><p>ì„œë²„ ì—°ê²° ì‹¤íŒ¨</p></div>`;
      }
    }

    function updateStats() {
      const total    = allEquipments.length;
      const reserved = allEquipments.filter(e => e.reserved).length;
      const broken   = allEquipments.filter(e => e.status !== 'ì •ìƒ').length;
      document.getElementById('sTotal').textContent    = total;
      document.getElementById('sAvail').textContent    = total - reserved;
      document.getElementById('sReserved').textContent = reserved;
      document.getElementById('sBroken').textContent   = broken;
    }

    function filterEquipList() {
      const q = document.getElementById('listSearch').value.toLowerCase();
      renderEquipTable(allEquipments.filter(e => e.name.toLowerCase().includes(q)), 'equipListWrap', true);
    }

    function renderEquipTable(list, wrapperId, showActions) {
      const wrap = document.getElementById(wrapperId);
      if (!list.length) {
        wrap.innerHTML = `<div class="empty-box"><div class="ei">ğŸ“­</div><p>ì¥ë¹„ê°€ ì—†ìŠµë‹ˆë‹¤</p></div>`;
        return;
      }
      const rows = list.map(eq => {
        const sc = eq.status === 'ì •ìƒ' ? 'normal' : eq.status === 'ìˆ˜ë¦¬' ? 'repair' : 'broken';
        const actions = showActions ? `
          <div class="td-actions">
            ${eq.reserved
                ? `<span style="font-size:.7rem;color:var(--text-dim);">ì˜ˆì•½ì¤‘</span>`
                : `<button class="btn-icon edit" onclick="openEditModal('${eq.id}')">âœï¸</button>
                    <button class="btn-icon del" data-id="${eq.id}" data-name="${eq.name}" onclick="handleDelete(this)">ğŸ—‘</button>`
            }
          </div>` : '';
        return `<tr>
          <td><span class="mono">${eq.id?.slice(0,8)}â€¦</span></td>
          <td>${eq.num}</td>
          <td><strong>${eq.name}</strong></td>
          <td><span class="badge ${sc}">${eq.status}</span></td>
          <td><span class="badge ${eq.reserved ? 'rsv-yes' : 'rsv-no'}">${eq.reserved ? 'ì˜ˆì•½ë¨' : 'ê°€ëŠ¥'}</span></td>
          <td><span class="mono">${eq.startdate ?? '-'}</span></td>
          <td><span class="mono">${eq.deadline ?? '-'}</span></td>
          ${showActions ? `<td>${actions}</td>` : ''}
        </tr>`;
      }).join('');

      wrap.innerHTML = `
        <table>
          <thead><tr>
            <th>ID</th><th>ë²ˆí˜¸</th><th>ì¥ë¹„ëª…</th><th>ìƒíƒœ</th><th>ì˜ˆì•½</th><th>ì˜ˆì•½ì¼</th><th>ë°˜ë‚©ê¸°í•œ</th>
            ${showActions ? '<th>ê´€ë¦¬</th>' : ''}
          </tr></thead>
          <tbody>${rows}</tbody>
        </table>`;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â‘¡ ë‹¨ê±´ ì¡°íšŒ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function searchByNum() {
      const num = document.getElementById('searchByNum').value;
      if (!num) { toast('error', 'ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
      try {
        const res = await fetch(`${API}/equipments/num/${num}`, { credentials: 'include' });
        if (!res.ok) { document.getElementById('searchResultWrap').innerHTML = `<div class="empty-box"><div class="ei">ğŸ”</div><p>í•´ë‹¹ ë²ˆí˜¸ì˜ ì¥ë¹„ê°€ ì—†ìŠµë‹ˆë‹¤</p></div>`; return; }
        const data = await res.json();
        renderEquipTable(Array.isArray(data) ? data : [data], 'searchResultWrap', false);
      } catch (e) { toast('error', 'ì„œë²„ ì—°ê²° ì˜¤ë¥˜'); }
    }

    async function searchByName() {
      const name = document.getElementById('searchByName').value.trim();
      if (!name) { toast('error', 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
      try {
        const res = await fetch(`${API}/equipments/name/${encodeURIComponent(name)}`, { credentials: 'include' });
        if (!res.ok) { document.getElementById('searchResultWrap').innerHTML = `<div class="empty-box"><div class="ei">ğŸ”</div><p>í•´ë‹¹ ì´ë¦„ì˜ ì¥ë¹„ê°€ ì—†ìŠµë‹ˆë‹¤</p></div>`; return; }
        const data = await res.json();
        renderEquipTable(Array.isArray(data) ? data : [data], 'searchResultWrap', false);
      } catch (e) { toast('error', 'ì„œë²„ ì—°ê²° ì˜¤ë¥˜'); }
    }

    function clearSearchResult() {
      document.getElementById('searchByNum').value  = '';
      document.getElementById('searchByName').value = '';
      document.getElementById('searchResultWrap').innerHTML =
        `<div class="empty-box"><div class="ei">ğŸ”</div><p>ë²ˆí˜¸ ë˜ëŠ” ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰í•˜ì„¸ìš”</p></div>`;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â‘¢ ì¥ë¹„ ë“±ë¡
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function addEquipment() {
      const num    = document.getElementById('addNum').value;
      const name   = document.getElementById('addName').value.trim();
      const status = document.getElementById('addStatus').value;
      if (!num || !name) { toast('error', 'ë²ˆí˜¸ì™€ ì¥ë¹„ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
      try {
        const res = await fetch(`${API}/equipments`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ num: Number(num), name, status })
        });
        if (res.ok) {
          toast('success', `âœ… "${name}" ì¥ë¹„ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
          clearAddForm();
          await loadEquipments();
        } else {
          toast('error', 'âŒ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (e) { toast('error', 'âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜'); }
    }

    function clearAddForm() {
      document.getElementById('addNum').value    = '';
      document.getElementById('addName').value   = '';
      document.getElementById('addStatus').value = 'ì •ìƒ';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â‘£ ìˆ˜ì •
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function openEditModal(id) {
      const eq = allEquipments.find(e => e.id === id);
      if (!eq) return;
      document.getElementById('editId').value     = id;
      document.getElementById('editNum').value    = eq.num;
      document.getElementById('editName').value   = eq.name;
      document.getElementById('editStatus').value = eq.status;
      openModal('editModal');
    }

    async function submitEdit() {
      const id     = document.getElementById('editId').value;
      const num    = document.getElementById('editNum').value;
      const name   = document.getElementById('editName').value.trim();
      const status = document.getElementById('editStatus').value;
      if (!num || !name) { toast('error', 'ë²ˆí˜¸ì™€ ì¥ë¹„ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
      try {
        const res = await fetch(`${API}/equipments/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ num: Number(num), name, status })
        });
        if (res.ok) {
          toast('success', `âœ… "${name}" ìˆ˜ì • ì™„ë£Œ`);
          closeModal('editModal');
          await loadEquipments();
        } else {
          toast('error', 'âŒ ìˆ˜ì • ì‹¤íŒ¨');
        }
      } catch (e) { toast('error', 'âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜'); }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â‘¤ ì¥ë¹„ ì‚­ì œ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function deleteEquipment(id) {
      try {
        const res = await fetch(`${API}/equipments/${id}`, {
          method: 'DELETE',
          credentials: 'include'
        });
        if (res.ok) {
          toast('info', 'ğŸ—‘ ì¥ë¹„ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          closeModal('confirmModal');
          await loadEquipments();
        } else {
          toast('error', 'âŒ ì‚­ì œ ì‹¤íŒ¨');
        }
      } catch (e) { toast('error', 'âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜'); }
    }

    function handleDelete(btn) {
        const id   = btn.dataset.id;
        const name = btn.dataset.name;
        openConfirm('ì¥ë¹„ ì‚­ì œ', `"${name}" ì¥ë¹„ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`, () => deleteEquipment(id));
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â‘¥ ì˜ˆì•½ í˜„í™©
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function loadReservations() {
        document.getElementById('reservationWrap').innerHTML =
            `<div class="loading-box"><div class="spinner"></div> ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>`;
        try {
            const [equipRes, userRes] = await Promise.all([
                fetch(`${API}/equipments`, { credentials: 'include' }),
                fetch(`${API}/auth/users`, { credentials: 'include' })
            ]);
            const equipments = await equipRes.json();
            const users      = userRes.ok ? await userRes.json() : [];
            const reserved   = equipments.filter(e => e.reserved === true || e.reserved === 1);

            if (!reserved.length) {
            document.getElementById('reservationWrap').innerHTML =
                `<div class="empty-box"><div class="ei">ğŸ“‹</div><p>í˜„ì¬ ì˜ˆì•½ëœ ì¥ë¹„ê°€ ì—†ìŠµë‹ˆë‹¤</p></div>`;
            return;
        }

            const rows = reserved.map(eq => {
            // userIdë¡œ ìœ ì € ì •ë³´ ë§¤ì¹­
            const user = users.find(u => u.id === eq.userId);
            return `<tr>
                <td><span class="mono">${eq.id?.slice(0,8)}â€¦</span></td>
                <td>${eq.num}</td>
                <td><strong>${eq.name}</strong></td>
                <td>${user ? `<strong>${user.name}</strong>` : '<span style="color:var(--text-dim)">ì•Œ ìˆ˜ ì—†ìŒ</span>'}</td>
                <td>${user ? `<span class="mono">${user.phone}</span>` : '-'}</td>
                <td><span class="mono">${eq.startdate ?? '-'}</span></td>
                <td><span class="mono">${eq.deadline ?? '-'}</span></td>
                <td><span class="badge rsv-yes">ì˜ˆì•½ì¤‘</span></td>
            </tr>`;
            }).join('');

            document.getElementById('reservationWrap').innerHTML = `
              <table>
                <thead><tr>
                  <th>ì¥ë¹„ ID</th><th>ë²ˆí˜¸</th><th>ì¥ë¹„ëª…</th><th>ì˜ˆì•½ì</th><th>ì „í™”ë²ˆí˜¸</th><th>ì˜ˆì•½ì¼</th><th>ë°˜ë‚©ê¸°í•œ</th><th>ìƒíƒœ</th>
                </tr></thead>
                <tbody>${rows}</tbody>
            </table>`;
        } catch (e) {
            document.getElementById('reservationWrap').innerHTML =
            `<div class="empty-box"><div class="ei">âš ï¸</div><p>ì„œë²„ ì—°ê²° ì‹¤íŒ¨</p></div>`;
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â‘¦ ìœ ì € ì¡°íšŒ & ì‚­ì œ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function loadUsers() {
      document.getElementById('userListWrap').innerHTML =
        `<div class="loading-box"><div class="spinner"></div> ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>`;
      try {
        const res = await fetch(`${API}/auth/users`, { credentials: 'include' });
        if (!res.ok) throw new Error();
        allUsers = await res.json();
        renderUserTable(allUsers);
      } catch (e) {
        document.getElementById('userListWrap').innerHTML =
          `<div class="empty-box"><div class="ei">âš ï¸</div><p>ìœ ì € ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br><small>GET /api/users ì—”ë“œí¬ì¸íŠ¸ê°€ í•„ìš”í•©ë‹ˆë‹¤</small></p></div>`;
      }
    }

    function filterUserList() {
      const q = document.getElementById('userSearch').value.toLowerCase();
      renderUserTable(allUsers.filter(u => u.name?.toLowerCase().includes(q) || u.phone?.includes(q)));
    }

    function renderUserTable(list) {
      if (!list.length) {
        document.getElementById('userListWrap').innerHTML =
          `<div class="empty-box"><div class="ei">ğŸ‘¥</div><p>ìœ ì €ê°€ ì—†ìŠµë‹ˆë‹¤</p></div>`;
        return;
      }
      const rows = list
        .filter(u => u.role !== 'ADMIN')   // ğŸ”¥ ê´€ë¦¬ì ì œì™¸
        .map(u => `
            <tr>
            <td><span class="mono">${u.id?.slice(0,8)}â€¦</span></td>
            <td><strong>${u.name}</strong></td>
            <td><span class="mono">${u.phone}</span></td>
            <td><span class="badge ${u.role === 'ADMIN' ? 'admin' : 'user'}">${u.role}</span></td>
            <td>
                <button class="btn-icon del" data-id="${u.id}" data-name="${u.name}" onclick="handleUserDelete(this)">ğŸ—‘</button>
            </td>
            </tr>
        `).join('');

      document.getElementById('userListWrap').innerHTML = `
        <table>
          <thead><tr><th>ID</th><th>ì´ë¦„</th><th>ì „í™”ë²ˆí˜¸</th><th>ê¶Œí•œ</th><th>ê´€ë¦¬</th></tr></thead>
          <tbody>${rows}</tbody>
        </table>`;
    }

    async function deleteUser(id) {
      try {
        const res = await fetch(`${API}/auth/user/${id}`, {
          method: 'DELETE',
          credentials: 'include'
        });
        if (res.ok) {
          toast('info', 'ğŸ—‘ ìœ ì €ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          closeModal('confirmModal');
          await loadUsers();
        } else {
          toast('error', 'âŒ ì‚­ì œ ì‹¤íŒ¨');
        }
      } catch (e) { toast('error', 'âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜'); }
    }
    function handleUserDelete(btn) {
        const id   = btn.dataset.id;
        const name = btn.dataset.name;
        openConfirm('ìœ ì € ì‚­ì œ', `"${name}" ìœ ì €ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`, () => deleteUser(id));
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ê³µí†µ ìœ í‹¸
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function openModal(id)  { document.getElementById(id).classList.add('show'); }
    function closeModal(id) { document.getElementById(id).classList.remove('show'); }

    function openConfirm(title, desc, callback) {
      document.getElementById('confirmTitle').textContent = title;
      document.getElementById('confirmDesc').textContent  = desc;
      pendingAction = callback;
      document.getElementById('confirmYesBtn').onclick = () => { if (pendingAction) pendingAction(); };
      openModal('confirmModal');
    }

    async function doLogout() {
      try { await fetch(`${API}/auth/logout`, { method: 'POST', credentials: 'include' }); } catch (e) {}
      location.href = '/login.html';
    }

    function toast(type, msg) {
      const el = document.getElementById('toast');
      el.textContent = msg;
      el.className   = `toast ${type} show`;
      clearTimeout(el._t);
      el._t = setTimeout(() => el.classList.remove('show'), 3000);
    }

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ë‹«ê¸°
    ['editModal','confirmModal'].forEach(id => {
      document.getElementById(id).addEventListener('click', e => {
        if (e.target === e.currentTarget) closeModal(id);
      });
    });

    // switchTabì— ì¶”ê°€
    if (tab === 'approvals') loadApprovals();

    // ì´ˆê¸° ë¡œë“œì— ì¶”ê°€
    window.onload = () => {
        loadEquipments();
        loadUsers();
        loadApprovals(); // ì¶”ê°€
    };

    // ìŠ¹ì¸ ìš”ì²­ ëª©ë¡ ë¡œë“œ
    async function loadApprovals() {
        document.getElementById('approvalWrap').innerHTML =
        `<div class="loading-box"><div class="spinner"></div> ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>`;
    try {
        const res = await fetch(`${API}/auth/pending`, { credentials: 'include' });
        if (!res.ok) throw new Error();
        const list = await res.json();

        // ë°°ì§€ ì—…ë°ì´íŠ¸
        const ac = document.getElementById('approvalCount');
        ac.textContent   = list.length;
        ac.style.display = list.length > 0 ? '' : 'none';

        if (!list.length) {
        document.getElementById('approvalWrap').innerHTML =
            `<div class="empty-box"><div class="ei">âœ…</div><p>ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤</p></div>`;
        return;
        }

        const rows = list.map(u => `
        <tr>
            <td><span class="mono">${u.id?.slice(0,8)}â€¦</span></td>
            <td><strong>${u.name}</strong></td>
            <td><span class="mono">${u.phone}</span></td>
            <td><span class="badge user">PENDING</span></td>
            <td>
            <div class="td-actions">
                <button class="btn-sm btn-primary" style="height:28px;font-size:.72rem;" onclick="approveUser('${u.id}')">âœ… ìŠ¹ì¸</button>
                <button class="btn-sm btn-danger"  style="height:28px;font-size:.72rem;" onclick="rejectUser('${u.id}')">âŒ ê±°ì ˆ</button>
            </div>
            </td>
        </tr>`).join('');

        document.getElementById('approvalWrap').innerHTML = `
            <table>
                <thead><tr>
            <th>ID</th><th>ì´ë¦„</th><th>ì „í™”ë²ˆí˜¸</th><th>ìƒíƒœ</th><th>ê´€ë¦¬</th>
            </tr></thead>
            <tbody>${rows}</tbody>
        </table>`;
    } catch (e) {
        document.getElementById('approvalWrap').innerHTML =
        `<div class="empty-box"><div class="ei">âš ï¸</div><p>ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</p></div>`;
    }
    }

    // ìŠ¹ì¸
    async function approveUser(id) {
    try {
        const res = await fetch(`${API}/auth/approve/${id}`, {
        method: 'PUT',
        credentials: 'include'
        });
        if (res.ok) {
        toast('success', 'âœ… ìŠ¹ì¸ ì™„ë£Œ');
        loadApprovals();
        loadUsers();
        } else {
        toast('error', 'âŒ ìŠ¹ì¸ ì‹¤íŒ¨');
        }
    } catch (e) { toast('error', 'âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜'); }
    }

    // ê±°ì ˆ
    async function rejectUser(id) {
    try {
        const res = await fetch(`${API}/auth/reject/${id}`, {
        method: 'PUT',
        credentials: 'include'
        });
        if (res.ok) {
        toast('info', 'ğŸš« ê±°ì ˆ ì™„ë£Œ');
        loadApprovals();
        loadUsers();
        } else {
            toast('error', 'âŒ ê±°ì ˆ ì‹¤íŒ¨');
          }
        } catch (e) { toast('error', 'âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜'); }
    }
</script>
</body>
</html>