<script>
    const API_BASE = 'http://localhost:8080/api/equipment';

    function showResult(data) {
        document.getElementById('result').textContent =
            typeof data === 'string'
                ? data
                : JSON.stringify(data, null, 2);
    }

    function handleError(error) {
        document.getElementById('result').textContent =
            '❌ 에러: ' + error;
    }

    //  전체 조회
    async function getEquipments() {
        try {
            const response = await fetch(`${API_BASE}/get`);
            const data = await response.json();
            showResult(data);
            renderTable(data);
        } catch (error) {
            handleError(error);
        }
    }

    //  테이블 렌더링 (num, name, status, deadline, startdate 기준)
    function renderTable(equipments) {
        const tbody = document.querySelector('#equipmentTable tbody');
        tbody.innerHTML = equipments.map(eq => `
            <tr>
                <td>${eq.num}</td>
                <td>${eq.name}</td>
                <td>-</td>
                <td>${eq.status}</td>
                <td>${eq.deadline ?? ''}</td>
                <td>
                    <button onclick="deleteEquipment(${eq.num})" class="danger">
                        삭제
                    </button>
                </td>
            </tr>
        `).join('');
    }

    //  등록
    async function createEquipment() {
        const equipment = {
            num: null,
            name: document.getElementById('name').value,
            status: document.getElementById('status').value,
            deadline: null,
            startdate: null
        };

        try {
            const response = await fetch(`${API_BASE}/post`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(equipment)
            });

            const data = await response.text();
            showResult(data);
            getEquipments();
        } catch (error) {
            handleError(error);
        }
    }

    //  수정
    async function updateEquipment() {
        const num = document.getElementById('editId').value;

        const equipment = {
            num: num,
            name: document.getElementById('editName').value,
            status: document.getElementById('editStatus').value,
            deadline: null,
            startdate: null
        };

        try {
            const response = await fetch(`${API_BASE}/put/${num}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(equipment)
            });

            const data = await response.text();
            showResult(data);
            getEquipments();
        } catch (error) {
            handleError(error);
        }
    }

    //  삭제
    async function deleteEquipment(num) {
        if (!confirm('정말 삭제하시겠습니까?')) return;

        try {
            const response = await fetch(`${API_BASE}/delete/${num}`, {
                method: 'DELETE'
            });

            const data = await response.text();
            showResult(data);
            getEquipments();
        } catch (error) {
            handleError(error);
        }
    }

    getEquipments();
</script>
